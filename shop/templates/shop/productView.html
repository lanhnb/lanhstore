{% extends 'pages/base22.html' %}
{% block title%}{{product.product_name}}
{%endblock%}
{% block productView %}
{% load static %}
<style>
.btn-primary {
  background-color: #ff5e14;
}
  .btn btn-primary {
    background-color: #ff5e14;}
#img_prdV{
        border-radius: 5px;
    box-shadow: 0.4em 0.4em 0.4em rgba( 0, 0, 0, 0.3 );
    transition: width 1s, height 2s;
    width:100%;
    height:auto;}
    
#img_prdV:hover{opacity: 0.8; width: 110%; height: 110%;
}
button#popcart {
    background-color: crimson;
    padding:16px;
    margin-top:2px;
}
.popover-body {
    background: yellow;
}
li#hb1{
    margin-top: 4px;
}

li#hb2{
    margin-top: 4px;
}

li#hb3{
    margin-top: 4px;
}
 
li#hb4{
    margin-top: 4px;
}
 

li#hb5{
    margin-top: 4px;
}
  
</style>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v12.0&appId=1561521837271142&autoLogAppEvents=1" nonce="7jeisJKo"></script>

<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v12.0&appId=1561521837271142&autoLogAppEvents=1" nonce="dwgl1A1r"></script>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4 align-items-center">
            <div class="row ">

                <img class="setting1" id="image" src="/media/{{product.image}}" width="233px" height="385px">
            </div>

            <div class="row">
                <div class="sp_nut">

                    <p>
                        <span id="divpr{{product.id}}" class="divpr">

                    <button id="pr{{product.id}}" class="btn btn-primary">Đặt mua</button></span>
                        <a href="/shop"><button class="btn btn-primary">Back</button></a></p>
                </div>
            </div>

        </div>



        <div style="text-align: justify;" class="col-md-8">
            <h2>{{product.product_name}}</h2>
            <p><b class="gia2">Giá:{{product.price}} VND</b></p>
              <p>{{product.product_name}}/CPU{{product.cpu}}/Ram{{product.ram}}/HD{{product.hdd}}</p>
            <div class="fb-like" data-href="http://127.0.0.1:8000/shop/{{product.product_id}}" data-width="" data-layout="button" data-action="like" data-size="small" data-share="true"></div>

            <p>{{product.desc}}</p>
            <div class="fb-comments" data-href="http://127.0.0.1:8000/shop/{{product.product_id}}" data-width="" data-numposts="3"></div>
        </div>
    </div>
</div>

{%endblock%}


{% block js %}
<script>

if(localStorage.getItem('cart') == null){
  var cart = {};

}else{
  cart = JSON.parse(localStorage.getItem('cart'));
  updateCart(cart);
  }
  // $('.cart').click(function(){
    $('.divpr').on('click', 'button.cart', function(){

    var idstr = this.id.toString();

    if (cart[idstr] !=undefined){
      qty = cart[idstr][0] + 1;
    }
    else{
      qty = 1;
      name = document.getElementById('name'+idstr).innerHTML;
      price = document.getElementById('price'+idstr).innerHTML;
      cart[idstr] = [qty, name, parseInt(price)];
    }

    updateCart(cart);
});
  //popcart show
$('#popcart').popover('show');
document.getElementById('popcart').setAttribute('data-content', '<h5> Sản phẩm đã chọn: </h5>');
updatePopover(cart);

function updatePopover(cart)
{

  var popStr="";
  var item = {{product.id}};
  for (var i in cart){

      popStr = popStr + "<h5> Sản phẩm đã chọn: </h5><div class='mx-2 my-2'>";
      popStr = popStr + "<b>" + i + "</b>. ";
      popStr = popStr + document.getElementById('name'+ item).innerHTML.slice(0, 19) + "-->S.lượng: " + cart[item][0] + '<br>';


  }

  popStr = popStr + "</div> <a href='/shop/checkout'><button class'btn btn-primary' id='checkout'>Check out</button></a> <button class'btn btn-primary' onclick='clearCart()' id='clearCart'>Clear Cart</button>"

  document.getElementById('popcart').setAttribute('data-content', popStr);
  $('#popcart').popover('show');

}

function clearCart(){
  cart  = JSON.parse(localStorage.getItem('cart'));
  for (var item in cart){
    document.getElementById('pr{{product.id}}').innerHTML ='<button id="'+ item +'" class="btn btn-primary cart">Mua hàng</button>'
  }
  localStorage.clear();
  cart ={};
  updateCart(cart);
}



function updateCart(cart){
  var sum = 0;
  for (var item in cart){
    sum = sum + cart[item][0];
    document.getElementById('').innerHTML = "<button id='minus" + item + "'class='btn btn-primary minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";

  }
  localStorage.setItem('cart', JSON.stringify(cart));
  document.getElementById('cart').innerHTML = sum;
  updatePopover(cart);
}

// khi plus or minus click
$('.divpr').on("click", "button.minus", function(){

  a = this.id.slice(7, );
  cart['pr'+a][0] = cart['pr'+a][0] -1;
  cart['pr'+a][0] = Math.max(0, cart['pr'+a][0]);
  document.getElementById('valpr'+a).innerHTML = cart['pr' +a][0];
  updateCart(cart);
});


$('.divpr').on("click", "button.plus", function(){

  a = this.id.slice(6, );
  cart['pr'+a][0] = cart['pr'+a][0] +1;
  document.getElementById('valpr'+a).innerHTML = cart['pr' +a][0];
  updateCart(cart);
});


( function() {
'use strict';
var count = 0;
var pic = document.getElementById( 'image' );
   pic.addEventListener( 'click',
    function() {
      count ++;
      if ( count === 3 ) {
           pic.classList.remove( 'setting' + count )
           count = 0;
        }

           pic.classList.remove( 'setting' + count );
           pic.classList.add( 'setting' + ( count + 1 )  );

    }, false );
}( document ));
</script>

{%endblock%}
